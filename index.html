<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <title>Ø§Ø­ØªÙ…Ø§Ù„ ØµØ¹ÙˆØ¯ Ø§Ù„Ø¨ÙŠØªÙƒÙˆÙŠÙ† Ø¨Ø¹Ø¯ Ø³Ø§Ø¹Ø©</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background: #f7f7f7;
            padding: 20px;
            direction: rtl;
        }
        #price {
            font-size: 2em;
            margin: 20px 0;
        }
        #probability {
            font-size: 1.5em;
            margin: 20px 0;
        }
        #countdown {
            font-size: 1.2em;
            color: #555;
        }
        .up { color: green; }
        .down { color: red; }
    </style>
</head>
<body>
    <h1>ğŸ“Š Ø§Ø­ØªÙ…Ø§Ù„ ØµØ¹ÙˆØ¯ Ø§Ù„Ø¨ÙŠØªÙƒÙˆÙŠÙ† Ø¨Ø¹Ø¯ Ø³Ø§Ø¹Ø©</h1>
    <div id="price">Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
    <div id="probability"></div>
    <div id="countdown"></div>

    <script>
        let nextHourTime = new Date();
        nextHourTime.setHours(nextHourTime.getHours() + 1, 0, 0, 0);

        function updateCountdown() {
            let now = new Date();
            let diff = nextHourTime - now;
            if (diff <= 0) {
                nextHourTime.setHours(nextHourTime.getHours() + 1);
                fetchAndPredict();
            }
            let minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            let seconds = Math.floor((diff % (1000 * 60)) / 1000);
            document.getElementById("countdown").textContent = 
                `â³ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${minutes} Ø¯Ù‚ÙŠÙ‚Ø© Ùˆ ${seconds} Ø«Ø§Ù†ÙŠØ©`;
        }

        async function fetchAndPredict() {
            try {
                const res = await fetch("https://api.coingecko.com/api/v3/coins/bitcoin/market_chart?vs_currency=usd&days=1&interval=minute");
                const data = await res.json();
                const prices = data.prices.map(p => p[1]);

                const lastPrice = prices[prices.length - 1];
                document.getElementById("price").textContent = `ğŸ’° Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ: $${lastPrice.toFixed(2)}`;

                // Ø­Ø³Ø§Ø¨ Ø§Ù„ØªØºÙŠØ±Ø§Øª ÙÙŠ Ø¢Ø®Ø± Ø³Ø§Ø¹Ø©
                const changes = [];
                for (let i = prices.length - 60; i < prices.length; i++) {
                    changes.push(prices[i] - prices[i - 1]);
                }

                const ups = changes.filter(c => c > 0).length;
                const downs = changes.filter(c => c < 0).length;

                const upProbability = (ups / (ups + downs)) * 100;
                document.getElementById("probability").innerHTML = 
                    `ğŸ”® Ø§Ù„Ø§Ø­ØªÙ…Ø§Ù„: <span class="${upProbability >= 50 ? 'up' : 'down'}">
                        ${upProbability.toFixed(1)}% ${upProbability >= 50 ? 'ØµØ¹ÙˆØ¯ ğŸ“ˆ' : 'Ù‡Ø¨ÙˆØ· ğŸ“‰'}
                    </span>`;
            } catch (e) {
                document.getElementById("price").textContent = "âš ï¸ Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª";
                console.error(e);
            }
        }

        setInterval(updateCountdown, 1000);
        fetchAndPredict();
        setInterval(fetchAndPredict, 60 * 1000);
    </script>
</body>
</html>
